{% extends "layout/backEndLayout.html.twig" %}

{% block content %}


<select class="form-select" id="select_room" aria-label="Default select example">
  <option    value="0" >Associees a toutes les classes</option>
   {% for room in rooms %}
        <option {% if app.request.get('id') == room.id %}selected{% endif %}  value={{room.id}}>{{room.name}}</option>
     {% endfor %}
</select>
<div class="row flex-nowrap justify-content-between align-items-center">
    <div class="col pt-1">

        <canvas id="canvas_gender">
        </canvas>
    </div>
    <div class="col pt-1">

        <canvas id="canvas_age_group">
        </canvas>
    </div>

</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}

    <script>
      let canvas_gender =$("#canvas_gender"), canvas_age_group =$("#canvas_age_group");

       const datasets = [];

       const randomRgbColor = () => {
          let r = Math.floor(Math.random() * 256); // Random between 0-255
          let g = Math.floor(Math.random() * 256); // Random between 0-255
          let b = Math.floor(Math.random() * 256); // Random between 0-255
          return 'rgb(' + r + ',' + g + ',' + b + ')';
      };

           {% if masculin is defined %}
              datasets.push( {
                  label: "Masculin",
                  data : {{masculin|raw}},
                  fill : false,
                  backgroundColor: randomRgbColor()
            } )
           {% endif %}
          {% if feminin is defined %}
              datasets.push( {
                  label: "Feminin",
                  data : {{feminin|raw}},
                  fill : false,
                  backgroundColor: randomRgbColor()
            } )
           {% endif %}

       let graph_gender = new Chart(canvas_gender, {
                            type:"bar",
                            data : {
                                labels: {{ roomNames|raw }},
                                datasets: datasets,
                            }, 
                             options: {
                                plugins: {
                                    title: {
                                        display: true,
                                        text: ' Repartition des sexes par classe ',
                                        font: {
                                            size: 24,
                                          
                                            family: 'Helvetica Neue',
                                        },
                                        position: 'bottom',
                                        
                                    }
                                }
                            }
                        });
       $('#select_room').on('change', function() {
            postData = {
              "id":  $(this).val()
            };
            $.ajax({
                type: "GET",
                url: "{{ path('admin_graph_update')}}",
                data: postData,
                datatype: "json",
                success: function (response) {
                        window.location.href = response.url;
                },
                error: function (e) {
                  console.log(e.message);
                }
          });
        });
        
              console.log( {{ ageGroupsLabel|raw }}, {{ ageGroupsWeight|raw }})

         let graph_age_group = new Chart(canvas_age_group, {
                            type:"pie",
                            data : {
                                labels: {{ ageGroupsLabel|raw }},
                                datasets: [{ 
                                  label : ' Repartition des ages par classe ',
                                  data : {{ ageGroupsWeight|raw }},
                                }]
                            }
                        });
       $('#select_room').on('change', function() {
            postData = {
              "id":  $(this).val()
            };
            $.ajax({
                type: "GET",
                url: "{{ path('admin_graph_update')}}",
                data: postData,
                datatype: "json",
                success: function (response) {
                        window.location.href = response.url;
                },
                error: function (e) {
                  console.log(e.message);
                }
          });
        });

    </script>
{% endblock %}
 